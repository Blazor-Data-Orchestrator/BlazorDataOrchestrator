@code {
    public string Stage { get; set; } = "login";
    public string CodeVersion = "2.1.0";
    public string DbVersion = "2.0.0";
    public List<string> Logs = new();
    private bool IsDowngrade => string.Compare(DbVersion, CodeVersion) > 0;
    private async Task RunScripts()
    {
        Stage = "running";
        Logs.Add($"[{DateTime.Now.ToShortTimeString()}] Starting backup...");
        await Task.Delay(1000);
        Logs.Add($"[{DateTime.Now.ToShortTimeString()}] Applying migration scripts...");
        await Task.Delay(1500);
        Logs.Add($"[{DateTime.Now.ToShortTimeString()}] Update Complete.");
    }
}
@if (Stage == "login")
{
    <div class="d-flex justify-content-center rz-mt-5">
        <RadzenCard Style="width: 450px;" Class="rz-shadow-5">
            <div class="text-center rz-mb-4">
                <RadzenIcon Icon="warning" IconColor="@Colors.Warning" Style="font-size: 3rem;" />
                <RadzenText TextStyle="TextStyle.H5" Class="rz-mt-2">System Update Required</RadzenText>
                <RadzenText TextStyle="TextStyle.Body2" Class="rz-color-base-500">Code: <strong>@CodeVersion</strong> | DB: <strong>@DbVersion</strong></RadzenText>
            </div>
            <RadzenText TextStyle="TextStyle.Subtitle1" Class="rz-mb-3">Super Admin Login</RadzenText>
            <div class="rz-mb-3"><RadzenTextBox Placeholder="Username" Style="width: 100%;" /></div>
            <div class="rz-mb-4"><RadzenPassword Placeholder="Password" Style="width: 100%;" /></div>
            <RadzenButton Click="@(() => Stage = "check")" Text="Authorize Upgrade" Style="width: 100%;" ButtonStyle="ButtonStyle.Primary" />
        </RadzenCard>
    </div>
}
else if (Stage == "check")
{
    <div class="d-flex justify-content-center rz-mt-5">
        <RadzenCard Style="width: 600px;" Class="rz-shadow-5">
            <div class="d-flex justify-content-between align-items-center rz-mb-5 rz-px-4">
                <div class="text-center">
                    <RadzenText TextStyle="TextStyle.Overline">DATABASE</RadzenText>
                    <RadzenText TextStyle="TextStyle.H4">@DbVersion</RadzenText>
                </div>
                <RadzenIcon Icon="arrow_forward" Style="font-size: 2rem; color: #ccc;" />
                <div class="text-center">
                    <RadzenText TextStyle="TextStyle.Overline">CODE</RadzenText>
                    <RadzenText TextStyle="TextStyle.H4" Class="rz-color-primary">@CodeVersion</RadzenText>
                </div>
            </div>
            @if (IsDowngrade)
            {
                <RadzenAlert AlertStyle="AlertStyle.Danger" ShowIcon="true" Variant="Variant.Flat" Shade="Shade.Lighter">
                    <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.Div">Critical Error</RadzenText>
                    Database version is higher than code version. You cannot downgrade the database automatically.
                </RadzenAlert>
                <RadzenButton Text="Cannot Proceed" ButtonStyle="ButtonStyle.Danger" Disabled="true" Style="width: 100%; margin-top: 1rem;" />
            }
            else
            {
                <RadzenAlert AlertStyle="AlertStyle.Info" ShowIcon="true" Variant="Variant.Flat" Shade="Shade.Lighter">
                    <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.Div">Upgrade Available</RadzenText>
                    Migration scripts are ready to be applied.
                </RadzenAlert>
                <RadzenButton Click="RunScripts" Text="Apply Update" ButtonStyle="ButtonStyle.Primary" Style="width: 100%; margin-top: 1rem;" />
            }
        </RadzenCard>
    </div>
}
else if (Stage == "running")
{
    <div class="d-flex justify-content-center rz-mt-5">
        <RadzenCard Style="width: 600px;" Class="rz-p-0">
            <div class="rz-p-3 rz-background-color-base-200" style="border-bottom: 1px solid #e0e0e0;">
                <RadzenText TextStyle="TextStyle.Subtitle2" Class="rz-m-0">Installation Log</RadzenText>
            </div>
            <div style="background-color: #1e1e1e; color: #00ff00; padding: 20px; height: 300px; overflow-y: auto; font-family: monospace;">
                @foreach(var log in Logs)
                {
                    <div style="margin-bottom: 4px;">@log</div>
                }
                <div class="rz-mt-2">_</div>
            </div>
        </RadzenCard>
    </div>
}
