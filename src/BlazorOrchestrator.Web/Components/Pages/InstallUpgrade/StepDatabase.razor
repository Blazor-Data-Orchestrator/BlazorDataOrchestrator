@using BlazorOrchestrator.Web.Data

@code {
    [Parameter] 
    public InstallationModel Model { get; set; } = new();

    class Option { public string Label { get; set; } = string.Empty; public string Value { get; set; } = string.Empty; }
    
    List<Option> connectionOptions = new() {
        new Option { Label = "Azure SQL (Managed Identity)", Value = "managed" },
        new Option { Label = "Manual Connection String", Value = "manual" }
    };
}

<div class="rz-p-2">
    <RadzenAlert AlertStyle="AlertStyle.Info" ShowIcon="true" Variant="Variant.Flat" Shade="Shade.Lighter" Class="rz-mb-4">
        Configure the primary SQL Server database connection for BlazorOrchestrator.
    </RadzenAlert>

    <div class="row rz-mb-4">
        <div class="col-md-12">
            <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Connection Method</RadzenText>
            <RadzenDropDown @bind-Value="Model.DbConnectionType" Data="@connectionOptions" TextProperty="Label" ValueProperty="Value" Style="width: 100%;" Name="ConnType" />
        </div>
    </div>

    @if (Model.DbConnectionType == "managed")
    {
        <RadzenCard Variant="Variant.Flat" Class="rz-background-color-base-100 d-flex align-items-center gap-3">
            <RadzenIcon Icon="check_circle" IconColor="@Colors.Success" />
            <div>
                <RadzenText TextStyle="TextStyle.Body2" Class="rz-m-0">
                    Will attempt auto-discovery via <strong>Azure Managed Identity</strong>.
                </RadzenText>
                <RadzenText TextStyle="TextStyle.Caption" Class="rz-color-base-400 rz-m-0">
                    Ensure your Azure App Service has the correct role assignments.
                </RadzenText>
            </div>
        </RadzenCard>
    }
    else
    {
        <div class="row animate__animated animate__fadeIn">
            <div class="col-md-12">
                <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">SQL Connection String</RadzenText>
                <RadzenTextArea @bind-Value="Model.DbConnectionString" Placeholder="Server=myServer;Database=myDB;User Id=myUser;Password=myPassword;..." Style="width: 100%; min-height: 100px;" />
                <RadzenText TextStyle="TextStyle.Caption" Class="rz-color-base-400">
                    Enter a complete SQL Server connection string.
                </RadzenText>
            </div>
        </div>
    }
</div>
